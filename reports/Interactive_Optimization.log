Traceback (most recent call last):
  File "/home/ludch/miniconda3/envs/jupyter_book/lib/python3.10/site-packages/jupyter_cache/executors/utils.py", line 51, in single_nb_execution
    executenb(
  File "/home/ludch/miniconda3/envs/jupyter_book/lib/python3.10/site-packages/nbclient/client.py", line 1085, in execute
    return NotebookClient(nb=nb, resources=resources, km=km, **kwargs).execute()
  File "/home/ludch/miniconda3/envs/jupyter_book/lib/python3.10/site-packages/nbclient/util.py", line 84, in wrapped
    return just_run(coro(*args, **kwargs))
  File "/home/ludch/miniconda3/envs/jupyter_book/lib/python3.10/site-packages/nbclient/util.py", line 62, in just_run
    return loop.run_until_complete(coro)
  File "/home/ludch/miniconda3/envs/jupyter_book/lib/python3.10/asyncio/base_events.py", line 641, in run_until_complete
    return future.result()
  File "/home/ludch/miniconda3/envs/jupyter_book/lib/python3.10/site-packages/nbclient/client.py", line 551, in async_execute
    await self.async_execute_cell(
  File "/home/ludch/miniconda3/envs/jupyter_book/lib/python3.10/site-packages/nbclient/client.py", line 846, in async_execute_cell
    self._check_raise_for_error(cell, exec_reply)
  File "/home/ludch/miniconda3/envs/jupyter_book/lib/python3.10/site-packages/nbclient/client.py", line 748, in _check_raise_for_error
    raise CellExecutionError.from_cell_and_msg(cell, exec_reply_content)
nbclient.exceptions.CellExecutionError: An error occurred while executing the following cell:
------------------
def cost(p):
    global counterCostCall
    """
    Himmelblau cost function.
    https://en.wikipedia.org/wiki/Himmelblau%27s_function
    """
    
    x, y = p 
    counterCostCall += 1
    return (x**2 + y -11)**2 + (x + y**2 -7)**2


Nx, Ny = 100, 100
x = np.linspace(-5., 5., Nx)
y = np.linspace(-5., 5., Ny)
X, Y = np.meshgrid(x, y)
zf = np.array([X.flatten(), Y.flatten()])
Z = cost(zf).reshape(Nx, Ny)
Z = np.where(Z > 200., np.nan, Z)
------------------

[0;31m---------------------------------------------------------------------------[0m
[0;31mNameError[0m                                 Traceback (most recent call last)
Input [0;32mIn [2][0m, in [0;36m<module>[0;34m[0m
[1;32m     16[0m X, Y [38;5;241m=[39m np[38;5;241m.[39mmeshgrid(x, y)
[1;32m     17[0m zf [38;5;241m=[39m np[38;5;241m.[39marray([X[38;5;241m.[39mflatten(), Y[38;5;241m.[39mflatten()])
[0;32m---> 18[0m Z [38;5;241m=[39m [43mcost[49m[43m([49m[43mzf[49m[43m)[49m[38;5;241m.[39mreshape(Nx, Ny)
[1;32m     19[0m Z [38;5;241m=[39m np[38;5;241m.[39mwhere(Z [38;5;241m>[39m [38;5;241m200.[39m, np[38;5;241m.[39mnan, Z)

Input [0;32mIn [2][0m, in [0;36mcost[0;34m(p)[0m
[1;32m      3[0m [38;5;124;03m"""[39;00m
[1;32m      4[0m [38;5;124;03mHimmelblau cost function.[39;00m
[1;32m      5[0m [38;5;124;03mhttps://en.wikipedia.org/wiki/Himmelblau%27s_function[39;00m
[1;32m      6[0m [38;5;124;03m"""[39;00m
[1;32m      8[0m x, y [38;5;241m=[39m p 
[0;32m----> 9[0m counterCostCall [38;5;241m+[39m[38;5;241m=[39m [38;5;241m1[39m
[1;32m     10[0m [38;5;28;01mreturn[39;00m (x[38;5;241m*[39m[38;5;241m*[39m[38;5;241m2[39m [38;5;241m+[39m y [38;5;241m-[39m[38;5;241m11[39m)[38;5;241m*[39m[38;5;241m*[39m[38;5;241m2[39m [38;5;241m+[39m (x [38;5;241m+[39m y[38;5;241m*[39m[38;5;241m*[39m[38;5;241m2[39m [38;5;241m-[39m[38;5;241m7[39m)[38;5;241m*[39m[38;5;241m*[39m[38;5;241m2[39m

[0;31mNameError[0m: name 'counterCostCall' is not defined
NameError: name 'counterCostCall' is not defined

